#! /usr/bin/env bash

# check that DOTFILES variable is defined
# shellcheck disable=SC1090
source "${BASH_SOURCE%/*}/../check_dotfiles_variable.sh"

source "$DOTFILES/infra/scripts/prompts.sh"

# set up git submodules
git submodule update --init && info "Initialized submodules"

# install python module for neovim (used by `black` plugin)
if command -v pip > /dev/null && pip -V | grep -q -E "3.7|3.8"; then
  pip install neovim ptpython black
elif command -v pip3 > /dev/null && pip3 -V | grep -q -E "3.7|3.8"; then
  pip3 install neovim ptpython black
fi

"$DOTFILES/infra/scripts/is_macos.sh" && {
  command -v mas > /dev/null || brew install "mas"

  # this line will error unless you have purchased Super Easy Timer. Delete or
  # comment this line out to avoid errors.
  # TODO: check for apple account first?
  # ref - https://github.com/mas-cli/mas
  mas "Super Easy Timer", id: 1353137878
}

# typescript repl
# ref - https://github.com/HerringtonDarkholme/typescript-repl
command -v npm > /dev/null && npm install --global tsun

# install vim plugins
nvim -c PlugInstall -c qa

# <<<< poetry >>>>
# TODO: fix poetry setup
# install poetry (Python dependency management)
# ref - https://github.com/sdispater/poetry#installation
# curl -sSL https://raw.githubusercontent.com/sdispater/poetry/master/get-poetry.py | python

# set poetry to create virtualenvs in project root
# ref - https://github.com/sdispater/poetry/issues/108
# poetry config settings.virtualenvs.in-project true
# <<<< end of poetry >>>>
