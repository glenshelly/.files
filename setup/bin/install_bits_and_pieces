#! /usr/bin/env bash

# check that DOTFILES variable is defined
source './lib/check_dotfiles_variable.sh'

source $DOTFILES/setup/lib/prompts.sh

# add `zsh` to allowed shells
sudo sh -c "echo $(which zsh) >> /etc/shells"
# change login shell to `zsh`
chsh -s "$(which zsh)" && info "Changed login shell to $(which zsh)"

# set up git submodules
git submodule update --init && info "Initialized submodules"

# add custom terminfo for tmux sessions
# `-x` to treat unknown capabilities as user defined
# ref - `man tic` or `tic --help`
tic -x "$DOTFILES/tmux/tmux-256color.terminfo" \
  && info "Installed $DOTFILES/tmux/tmux-256color.terminfo"

# install zsh plugins
antibody bundle < "$DOTFILES/zsh/plugins.txt" > "$DOTFILES/zsh/plugins.sh"
  && info "Installed zsh plugins w/ antibody"

# install `tmuxinator`
# ref - https://github.com/tmuxinator/tmuxinator
command -v gem > /dev/null 2>&1 || gem install --user-install tmuxinator

# install python module for neovim (used by `black` plugin)
command -v pip > /dev/null 2>&1 && pip -V | grep -q -E "3.7|3.8" && {
  pip install neovim ptpython black
} || {
  command -v pip3 > /dev/null 2>&1 && pip3 -V | grep -q -E "3.7|3.8" && {
    pip3 install neovim ptpython black
  }
}
